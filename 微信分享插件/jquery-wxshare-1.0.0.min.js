(function($) {
	$.mini = {
		wxshare: function(settings) {
			var defaults = {
				otitle: '默认标题', // 分享标题
				odesc: '默认描述', // 分享描述
				olink: window.location.href.split('#')[0],
				oimgUrl: 'http://wchat.ejiubo.net/test.jpg', // 分享图标
				otype: '', // 分享类型,music、video或link，不填默认为link
				odataUrl: '' // 如果type是music或video，则要提供数据链接，默认为空
			};
			
			var settings = $.extend(defaults,settings);
			
			document.writeln("<div class=\'test1\' style=\'display:none;\'></div>");
			document.writeln("<div class=\'test2\' style=\'display:none;\'></div>");
			document.writeln("<div class=\'test3\' style=\'display:none;\'></div>");
			
			document.writeln("<!--form表单只提交数据不跳转的方法：给form标签添加target属性，值为一个空iframe的name值-->");
			document.writeln("<iframe src=\'\' name=\'iframe\' frameborder=\'0\' style=\'display:none;\'></iframe>");
			document.writeln("<form action=\'get_wxSha.php\' method=\'post\' target=\'iframe\' style=\'display:none;\'>");
			document.writeln("	<input type=\'text\' value=\'\' name=\'myHref\' />");
			document.writeln("</form>");
			
			//获取当前页面除去'#'hash部分的链接
			var url = location.href.split('#')[0];
			$("input").val(url);
			//alert(url)
			if(url){
				//模拟表单提交post数据 $_{POST}只接收表单数据
				$("form").submit();
				$.ajax({
				  type: "post",
				  //contentType: "application/json", 
				  url: "http://wap.ejiubo.net/get_wxSha.php",
				  //dataType: "json",
				  data: {myHref: $("input").val()},
				  success: function(data,status){
					//alert("数据: \n" + data + "\n状态: " + status);
					var json = JSON.parse(data);
					$(".test1").html(json.timestamp);
					$(".test2").html(json.signature);
					$(".test3").html(json.myHref);
					
					wx.config({
						//debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
						appId: 'wx5e21019f7d25a78b', // 必填，公众号的唯一标识
						timestamp: $(".test1").text(), // 必填，生成签名的时间戳
						nonceStr: 'gjgklsdsgjsgj', // 必填，生成签名的随机串
						signature: $(".test2").text(),// 必填，签名，见附录1
						jsApiList: [
						        'onMenuShareTimeline',
								'onMenuShareAppMessage'
						] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
					});
					
					wx.ready(function () {
				        wx.onMenuShareTimeline({
							title: settings.otitle, // 分享标题
							desc: settings.odesc, // 分享描述
							link: settings.olink,
							imgUrl: settings.oimgUrl, // 分享图标
							type: settings.otype, // 分享类型,music、video或link，不填默认为link
							dataUrl: settings.odataUrl, // 如果type是music或video，则要提供数据链接，默认为空
							success: function () { 
							//alert(1111)
								// 用户确认分享后执行的回调函数
							},
							cancel: function () { 
							
								// 用户取消分享后执行的回调函数
							}
						});
						wx.onMenuShareAppMessage({
							title: settings.otitle, // 分享标题
							desc: settings.odesc, // 分享描述
							link: settings.olink,
							imgUrl: settings.oimgUrl, // 分享图标
							type: settings.otype, // 分享类型,music、video或link，不填默认为link
							dataUrl: settings.odataUrl, // 如果type是music或video，则要提供数据链接，默认为空
							success: function () { 
							//alert(1111)
								// 用户确认分享后执行的回调函数
							},
							cancel: function () { 
							
								// 用户取消分享后执行的回调函数
							}
						});
					   
					})
				  },
				  error: function(){
					  alert('fail');
				  }
				});
			}
		}
	}
})(jQuery);